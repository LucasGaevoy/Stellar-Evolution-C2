<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Stellar Evolution</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    .info .val{
      display: inline-block;
      min-width: 140px;   /* tweak: 120–180 depending on your taste */
      }
    body{
      margin: 0;
      padding: 0;
      background: #f4f6f8;
      font-family: Arial, sans-serif;
      text-align: center;
    }

    .format{
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
    }

    .title{
      text-align: center;
      margin: 0 0 30px 0;
      font-weight: 600;
    }

    h3{
      text-align: center;
      color: #000000;
      margin-top: 7px;
      margin-bottom: 5px;
    }

    .container{
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 20px;
    }

    .panel{
      background-color: #e8f0f8;
      border-radius: 12px;
      padding: 15px;
      height: 540px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
    }

    #star-view{
      position: relative;
      text-align: left;
      display: flex;
      flex-direction: column;
      padding: 15px;
      flex: 3;
      min-width: 350px;
    }

    .info { flex: 0 0 auto; }

    #scene { flex: 1 1 auto; min-height: 320px;}
    

    .mass-box{
      position: absolute;
      top: 15px;
      right: 15px;
      width: auto;
    }

    .mass-label{
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      margin-bottom: 6px;
    }

    .time-box{
      margin-top: auto;
      display: flex;
      gap: 10px;
      margin-top: auto;
    }

    .time-label{
      font-size: 14px;
      white-space: nowrap;
    }

    #PlayButton{
      font-size: 16px;
      cursor: pointer;
    }

    .slidecontainer {
    width: 300px;
    margin: 10px auto;
    }

    .slider {
    appearance: none;
    width: 100%;
    height: 20px;
    background: #d3d3d3;
    outline: none;
    opacity: 0.7;
    -webkit-transition: .2s;
    transition: opacity .2s;
    }

    .slider:hover {
    opacity: 1;
    }

    .slider::-webkit-slider-thumb {
    appearance: none;
    width: 20px;
    height: 20px;
    background: #759ec0;
    cursor: pointer;
    }
    .slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: #759ec0;
    cursor: pointer;
    }

    #hr-diagram{
      flex: 2;
      height: 540px;
      min-width:350px;
    }
  </style>
</head>

<body>

<div class="format">

  <h1 class="title">Stellar Evolution</h1> 

  <div class="container">
    
    <div id="star-view" class="panel">
      
      <div class="info">
        Absolute Magnitude: <span id="absMag">—</span><br>
        Surface Temperature: <span id="surfTemp">—</span><br>
        Evolutionary Stage: <span id="stage">—</span><br>
        Age: <span id="age">—</span><br>
        Mass: <span id="massReadout">—</span><br>
      </div>
      <div id="scene" style="width:100%; height:320px; border-radius:10px; overflow:hidden;"></div>

      <div class="mass-box">
        <div style="display:flex; align-items:center; gap:5px; margin-bottom:5px;">
          <label>Mass:</label>
          <select id="MassValues" style="width:120px;">
            <option value="0.1">0.1</option>
            <option value="0.5">0.5</option>
            <option value="1">1</option>
            <option value="3">3</option>
            <option value="10">10</option>
            <option value="100">100</option>
          </select>
          M<sub>&odot;</sub>
        </div>
      </div>

      <div class="time-box" style="display:flex; flex-direction: column; gap: 10px; margin-top: auto;">
        <div style="display:flex; align-items: center; gap: 10px;">
          <button class="PlayButton" id="play-pre" data-index="1" type="button">&#9654;</button>
          <span class="time-label">
            Before main sequence: <span class="TimeDemo" id="pct-pre">0</span>%
          </span>
          <input type="range" id="time-pre" min="0" max="100" value="0" class="TimeSlider" style="flex:1;">
      </div>

        <div style="display:flex; align-items: center; gap: 10px;">
          <button class="PlayButton" id="play-ms" data-index="2" type="button">&#9654;</button>
          <span class="time-label">
            Main sequence: <span class="TimeDemo" id="pct-ms">0</span>%
          </span>
          <input type="range" id="time-ms" min="0" max="100" value="0" class="TimeSlider" style="flex:1;">
        </div>
        
        <div style="display:flex; align-items: center; gap: 10px;">
          <button class="PlayButton" id="play-post" data-index="3" type="button">&#9654;</button>
          <span class="time-label">
            After main sequence: <span class="TimeDemo" id="pct-post">0</span>%
          </span>
          <input type="range" id="time-post" min="0" max="100" value="0" class="TimeSlider" style="flex:1;">
        </div>
      </div>
      
    </div>

    <div id="hr-diagram" class="panel">
      <h3>HR diagram</h3>
      <canvas id="diagram" width="500" height="500"></canvas>
      

    </div>

  </div>

  
  <script>
    let mass;
    window.onload = function(){
      const MassValues = document.getElementById("MassValues");
      const massReadout = document.getElementById("massReadout");
      mass = parseFloat(MassValues.value);
      massReadout.innerText = mass;
      MassValues.onchange = function(){
      mass = parseFloat(this.value);
      massReadout.innerText = mass;
    }
    }
    
    const canvas = document.getElementById("diagram");
    const ctx = canvas.getContext("2d");
    
    const cssWidth = 400;
    const cssHeight = 480;
    canvas.style.width = cssWidth + "px";
    canvas.style.height = cssHeight + "px";
    const dpr = window.devicePixelRatio || 1;
    canvas.width = cssWidth * dpr;
    canvas.height = cssHeight * dpr;
    ctx.scale(dpr,dpr);
    
    const margin = { top: 30, right: 20, bottom: 40, left: 40 };
    const TotalWidth = cssWidth - margin.left - margin.right;
    const TotalHeight = cssHeight - margin.top - margin.bottom;

    const TempMin = 1000;
    const TempMax = 75000;
    const MagMin = -15;
    const MagMax = 20;

    function YAxis(Mag){
      return margin.top + TotalHeight * (Mag - MagMin) / (MagMax - MagMin);
    }

    function XAxis(Temp){
      return margin.left + TotalWidth * (TempMax - Temp) / (TempMax - TempMin);
    }

    ctx.clearRect(0,0,cssWidth,cssHeight);

    let grad = ctx.createLinearGradient(margin.left, 0, margin.left + TotalWidth, 0);
    grad.addColorStop(0,"rgba(0,0,255,0.3)");
    grad.addColorStop(0.6,"rgba(255,255,255,0.3)");
    grad.addColorStop(0.75,"rgba(255,255,0,0.3)");
    grad.addColorStop(0.9,"rgba(255,165,0,0.3)");
    grad.addColorStop(1,"rgba(255,0,0,0.3)");
    ctx.fillStyle = grad;
    ctx.fillRect(margin.left, margin.top, TotalWidth, TotalHeight);

    ctx.textAlign = "center";
    ctx.fillStyle = "#000";
    ctx.fillText("Surface Temperature (K)", margin.left + TotalWidth/2, margin.top + TotalHeight + 40);
    ctx.save();
    ctx.translate(20,margin.top + TotalHeight/2);
    ctx.rotate(-Math.PI/2);
    ctx.textAlign = "center";
    ctx.fillText("Absolute Magnitude",0,0);
    ctx.restore();

    ctx.textAlign = "center";
    ctx.textBaseline = "top";
    ctx.fillStyle = "#000";
    for(let t=TempMin; t<=TempMax; t+=9000){
      let x = XAxis(t);
      ctx.moveTo(x,margin.top + TotalHeight);
      ctx.lineTo(x,margin.top + TotalHeight +5);
      ctx.stroke();
      ctx.fillStyle = "#000";
      ctx.fillText(t,x,margin.top + TotalHeight + 8);
      ctx.strokeStyle = "#ccc";
      ctx.beginPath();
      ctx.moveTo(x,margin.top);
      ctx.lineTo(x,margin.top + TotalHeight);
      ctx.stroke();
    }
    ctx.textAlign = "right";
    ctx.textBaseline = "middle";
    for(let M=MagMin; M<=MagMax; M+=5){
      let y = YAxis(M);
      ctx.moveTo(margin.left-5,y);
      ctx.lineTo(margin.left,y);
      ctx.stroke();
      ctx.fillStyle = "#000";
      ctx.fillText(M,margin.left-8,y);
      ctx.strokeStyle = "#ccc";
      ctx.beginPath();
      ctx.moveTo(margin.left-5,y);
      ctx.lineTo(margin.left + TotalWidth,y);
      ctx.stroke();
    }

    ctx.strokeStyle = "#000";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(margin.left,margin.top + TotalHeight);
    ctx.lineTo(margin.left + TotalWidth, margin.top + TotalHeight);
    ctx.moveTo(margin.left,margin.top);
    ctx.lineTo(margin.left,margin.top + TotalHeight);
    ctx.stroke();

    function Labels(text, pos, angle = 0){
      ctx.save();
      ctx.translate(XAxis(pos[0]), YAxis(pos[1]));
      ctx.rotate(angle);
      ctx.font = "12px sans-serif";
      ctx.fillStyle = "rgba(0,0,0,0.7)";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(text,0,0);
      ctx.restore();
    }
    Labels("Main Sequence", [18000,5],Math.PI/4);
    Labels("White Dwarfs", [23000,13.2]);
    Labels("Giants", [6400,1]);
    Labels("Supergiants", [12000,-5]);
    Labels("Pre-Main Sequence",[8500,4])

  </script>

</div>
<script type="module" src="./ui.js"></script>
<script type="module" src="./star.js"></script>

</body>
</html>